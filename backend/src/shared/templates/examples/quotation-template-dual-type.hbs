<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotizaci√≥n {{quotationCode}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 11pt;
      line-height: 1.5;
      color: #333;
    }

    .container {
      padding: 20mm;
      max-width: 180mm;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid #0066cc;
    }

    .logo {
      max-width: 150px;
      max-height: 80px;
    }

    .company-info {
      text-align: right;
      font-size: 10pt;
      color: #666;
    }

    /* Title */
    .quotation-title {
      text-align: center;
      margin-bottom: 30px;
    }

    .quotation-title h1 {
      font-size: 24pt;
      color: #0066cc;
      margin-bottom: 5px;
    }

    .quotation-code {
      font-size: 14pt;
      color: #666;
      font-weight: bold;
    }

    .quotation-type-badge {
      display: inline-block;
      padding: 5px 15px;
      margin-top: 10px;
      border-radius: 20px;
      font-size: 10pt;
      font-weight: bold;
      text-transform: uppercase;
    }

    .badge-time-based {
      background-color: #e3f2fd;
      color: #1976d2;
      border: 2px solid #1976d2;
    }

    .badge-service-based {
      background-color: #f3e5f5;
      color: #7b1fa2;
      border: 2px solid #7b1fa2;
    }

    /* Info Grid */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .info-section {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
    }

    .info-section h3 {
      font-size: 12pt;
      color: #0066cc;
      margin-bottom: 10px;
      border-bottom: 2px solid #0066cc;
      padding-bottom: 5px;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      font-size: 10pt;
    }

    .info-label {
      font-weight: bold;
      color: #666;
    }

    .info-value {
      color: #333;
    }

    /* Time-Based Specific */
    .rental-period-box {
      background: #fff3e0;
      border: 2px solid #ff9800;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .rental-period-box h3 {
      color: #e65100;
      margin-bottom: 10px;
    }

    /* Service-Based Specific */
    .service-description-box {
      background: #fce4ec;
      border: 2px solid #c2185b;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .service-description-box h3 {
      color: #880e4f;
      margin-bottom: 10px;
    }

    /* Items Table */
    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    .items-table th {
      background-color: #0066cc;
      color: white;
      padding: 12px 8px;
      text-align: left;
      font-size: 10pt;
      font-weight: bold;
    }

    .items-table td {
      padding: 10px 8px;
      border-bottom: 1px solid #ddd;
      font-size: 10pt;
    }

    .items-table tr:hover {
      background-color: #f5f5f5;
    }

    .item-description {
      font-weight: bold;
      color: #333;
    }

    .item-details {
      font-size: 9pt;
      color: #666;
      margin-top: 5px;
    }

    .item-detail-badge {
      display: inline-block;
      background: #e3f2fd;
      color: #1565c0;
      padding: 2px 8px;
      border-radius: 4px;
      margin-right: 5px;
      margin-top: 3px;
      font-size: 8pt;
    }

    .price-breakdown {
      font-size: 9pt;
      color: #666;
      margin-top: 5px;
      padding-left: 10px;
      border-left: 3px solid #4caf50;
    }

    .text-right {
      text-align: right;
    }

    .text-center {
      text-align: center;
    }

    /* Totals */
    .totals-section {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 30px;
    }

    .totals-box {
      width: 300px;
      background: #f9f9f9;
      border: 2px solid #0066cc;
      border-radius: 8px;
      padding: 15px;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 11pt;
    }

    .total-row.grand-total {
      border-top: 2px solid #0066cc;
      margin-top: 10px;
      padding-top: 10px;
      font-size: 14pt;
      font-weight: bold;
      color: #0066cc;
    }

    /* Notes */
    .notes-section {
      background: #fffde7;
      border-left: 4px solid #fbc02d;
      padding: 15px;
      margin-bottom: 20px;
    }

    .notes-section h3 {
      color: #f57f17;
      margin-bottom: 10px;
      font-size: 11pt;
    }

    .notes-section p {
      font-size: 10pt;
      color: #666;
    }

    /* Terms */
    .terms-section {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      font-size: 9pt;
      color: #666;
    }

    .terms-section h3 {
      color: #333;
      margin-bottom: 10px;
      font-size: 11pt;
    }

    /* Footer */
    .footer {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 2px solid #ddd;
      text-align: center;
      font-size: 9pt;
      color: #999;
    }

    /* Utilities */
    .highlight {
      background-color: #ffeb3b;
      padding: 2px 5px;
      border-radius: 3px;
    }

    .badge-override {
      background-color: #ff9800;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 8pt;
      margin-left: 5px;
    }

    .badge-discount {
      background-color: #4caf50;
      color: white;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 8pt;
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div>
        {{#if logoUrl}}
        <img src="{{logoUrl}}" alt="Logo" class="logo">
        {{/if}}
      </div>
      <div class="company-info">
        <strong>{{businessUnitName}}</strong><br>
        Fecha: {{quotationDate}}<br>
        V√°lida hasta: {{validUntil}}
      </div>
    </div>

    <!-- Title -->
    <div class="quotation-title">
      <h1>COTIZACI√ìN</h1>
      <div class="quotation-code">{{quotationCode}}</div>
      {{#if isTimeBased}}
      <div class="quotation-type-badge badge-time-based">
        Alquiler por Tiempo
      </div>
      {{/if}}
      {{#if isServiceBased}}
      <div class="quotation-type-badge badge-service-based">
        Servicio / Proyecto
      </div>
      {{/if}}
    </div>

    <!-- Info Grid -->
    <div class="info-grid">
      <!-- Cliente -->
      <div class="info-section">
        <h3>Cliente</h3>
        <div class="info-row">
          <span class="info-label">Nombre:</span>
          <span class="info-value">{{clientName}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email:</span>
          <span class="info-value">{{clientEmail}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Tel√©fono:</span>
          <span class="info-value">{{clientPhone}}</span>
        </div>
      </div>

      <!-- Quotation Info -->
      <div class="info-section">
        <h3>Informaci√≥n de la Cotizaci√≥n</h3>
        <div class="info-row">
          <span class="info-label">C√≥digo:</span>
          <span class="info-value">{{quotationCode}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Fecha:</span>
          <span class="info-value">{{quotationDate}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">V√°lida hasta:</span>
          <span class="info-value">{{validUntil}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Moneda:</span>
          <span class="info-value">{{currency}}</span>
        </div>
      </div>
    </div>

    <!-- TIME-BASED: Rental Period Box -->
    {{#if isTimeBased}}
    <div class="rental-period-box">
      <h3>üìÖ Per√≠odo de Alquiler Estimado</h3>
      <div class="info-grid">
        <div class="info-row">
          <span class="info-label">Fecha Inicio:</span>
          <span class="info-value">{{estimatedStartDate}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Fecha Fin:</span>
          <span class="info-value">{{estimatedEndDate}}</span>
        </div>
        <div class="info-row">
          <span class="info-label">D√≠as Estimados:</span>
          <span class="info-value">{{estimatedDays}} d√≠as</span>
        </div>
      </div>
    </div>
    {{/if}}

    <!-- SERVICE-BASED: Service Description Box -->
    {{#if isServiceBased}}
    <div class="service-description-box">
      <h3>üîß Descripci√≥n del Servicio / Proyecto</h3>
      <p>{{serviceDescription}}</p>
    </div>
    {{/if}}

    <!-- Items Table -->
    <table class="items-table">
      <thead>
        <tr>
          <th style="width: 5%;">#</th>
          <th style="width: 40%;">Descripci√≥n</th>
          <th style="width: 10%;" class="text-center">Cantidad</th>
          {{#if isTimeBased}}
          <th style="width: 15%;" class="text-center">Per√≠odo</th>
          {{/if}}
          <th style="width: 15%;" class="text-right">Precio Unit.</th>
          <th style="width: 15%;" class="text-right">Total</th>
        </tr>
      </thead>
      <tbody>
        {{#each items}}
        <tr>
          <td class="text-center">{{@index}}</td>
          <td>
            <div class="item-description">
              {{this.description}}
              {{#if this.priceOverridden}}
              <span class="badge-override">PRECIO AJUSTADO</span>
              {{/if}}
              {{#if this.discount}}
              <span class="badge-discount">-{{this.discount}} {{../currency}}</span>
              {{/if}}
            </div>
            {{#if this.assetName}}
            <div class="item-details">
              <strong>Asset:</strong> {{this.assetName}}
              {{#if this.assetCategory}}
              <span class="item-detail-badge">{{this.assetCategory}}</span>
              {{/if}}
            </div>
            {{/if}}

            <!-- TIME-BASED: Detalles de Rental -->
            {{#if ../isTimeBased}}
            <div class="item-details">
              {{#if this.rentalPeriodType}}
              <span class="item-detail-badge">
                {{#if (eq this.rentalPeriodType "hourly")}}‚è±Ô∏è Por Hora{{/if}}
                {{#if (eq this.rentalPeriodType "daily")}}üìÖ Por D√≠a{{/if}}
                {{#if (eq this.rentalPeriodType "weekly")}}üìÜ Por Semana{{/if}}
                {{#if (eq this.rentalPeriodType "monthly")}}üóìÔ∏è Por Mes{{/if}}
              </span>
              {{/if}}
              
              {{#if this.standbyHours}}
              <span class="item-detail-badge">‚è∏Ô∏è Standby: {{this.standbyHours}} hrs/d√≠a</span>
              {{/if}}

              {{#if this.operatorIncluded}}
              <span class="item-detail-badge">
                üë∑ Operador Incluido
                {{#if this.operatorCostType}}
                ({{this.operatorCostType}})
                {{/if}}
              </span>
              {{/if}}
            </div>

            <!-- Desglose de Precios -->
            {{#if this.basePrice}}
            <div class="price-breakdown">
              <strong>Desglose:</strong><br>
              Precio Base: {{this.basePrice}} {{../currency}}
              {{#if this.operatorCostAmount}}
              <br>+ Operador: {{this.operatorCostAmount}} {{../currency}}
              {{/if}}
              {{#if this.maintenanceCost}}
              <br>+ Mantenimiento: {{this.maintenanceCost}} {{../currency}}
              {{/if}}
              {{#if this.discount}}
              <br>- Descuento: {{this.discount}} {{../currency}}
              {{#if this.discountReason}}
              ({{this.discountReason}})
              {{/if}}
              {{/if}}
              {{#if this.priceOverridden}}
              <br><em>‚ö†Ô∏è Precio ajustado manualmente de {{this.calculatedUnitPrice}} a {{this.unitPrice}} {{../currency}}</em>
              {{/if}}
            </div>
            {{/if}}
            {{/if}}
          </td>
          <td class="text-center">{{this.quantity}}</td>
          {{#if ../isTimeBased}}
          <td class="text-center">
            {{#if this.rentalDays}}
            {{this.rentalDays}} d√≠as
            {{else}}
            -
            {{/if}}
          </td>
          {{/if}}
          <td class="text-right">{{this.unitPrice}} {{../currency}}</td>
          <td class="text-right">{{this.total}} {{../currency}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>

    <!-- Totals -->
    <div class="totals-section">
      <div class="totals-box">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>{{subtotal}} {{currency}}</span>
        </div>
        <div class="total-row">
          <span>IVA ({{taxRate}}%):</span>
          <span>{{taxAmount}} {{currency}}</span>
        </div>
        <div class="total-row grand-total">
          <span>TOTAL:</span>
          <span>{{totalAmount}} {{currency}}</span>
        </div>
      </div>
    </div>

    <!-- Notes -->
    {{#if notes}}
    <div class="notes-section">
      <h3>üìå Notas Importantes</h3>
      <p>{{notes}}</p>
    </div>
    {{/if}}

    <!-- Terms and Conditions -->
    {{#if termsAndConditions}}
    <div class="terms-section">
      <h3>T√©rminos y Condiciones</h3>
      <p>{{termsAndConditions}}</p>
    </div>
    {{/if}}

    <!-- Footer -->
    <div class="footer">
      <p>
        Este documento es una cotizaci√≥n formal v√°lida hasta {{validUntil}}.<br>
        {{#if isTimeBased}}
        Los precios est√°n sujetos a confirmaci√≥n de disponibilidad y fechas exactas de alquiler.<br>
        <strong>Importante:</strong> Los cargos diarios se generar√°n autom√°ticamente durante el per√≠odo del contrato.
        {{/if}}
        {{#if isServiceBased}}
        Este servicio se cotiza a precio fijo seg√∫n los t√©rminos acordados.<br>
        <strong>Importante:</strong> Los pagos se realizar√°n seg√∫n los milestones definidos en el contrato.
        {{/if}}
      </p>
      <p style="margin-top: 10px;">
        <strong>{{businessUnitName}}</strong> - Generado autom√°ticamente
      </p>
    </div>
  </div>
</body>
</html>
